import{bV as d,r as n,ab as F,aa as _,at as t,au as w,ac as s,ao as y,ae as i,bW as O,ak as h,am as V}from"./index-CCitMuP0.js";import{S as b}from"./index-D0bqSJqz.js";import{S as E}from"./index-B--uBO5R.js";function M(a,u,o){return d.get(`/users?page=${a}&pageSize=${u}&username=${o}`)}function R(a){return d.post("/userSave",a)}function U(a){return d.post("/userDelete",a)}function $(a){return d.post("/userEnabled",a)}const{Option:k}=b,q=n.forwardRef(({onSuccess:a},u)=>{const o=F(e=>e.userInfo),x=_(),[r]=t.useForm(),[c,m]=n.useState(!1),[g,j]=n.useState([]),[I,f]=n.useState(!1);n.useImperativeHandle(u,()=>({open:e=>{var l;r.resetFields(),e?r.setFieldsValue({...e,roleIds:((l=e.roleIds)==null?void 0:l.map(p=>p))||[]}):r.setFieldsValue({enabled:!0,roleIds:[]}),m(!0)}})),n.useEffect(()=>{c&&S()},[c]);const S=async()=>{const e=await w(1,9999,"");j(e.data)},v=async()=>{try{f(!0);const e=await r.validateFields(),l=await R(e),p=e.roleIds;x(O({...o,roleIds:p})),l.code===200?(h.success(l.message),m(!1),a(),e.id===o.id&&V()):h.error(l.message||"保存失败")}finally{f(!1)}};return s.jsx(y,{title:r.getFieldValue("id")?"编辑用户":"新增用户",open:c,onCancel:()=>m(!1),onOk:v,confirmLoading:I,width:500,destroyOnHidden:!0,children:s.jsxs(t,{form:r,labelCol:{span:5},children:[s.jsx(t.Item,{name:"id",hidden:!0,children:s.jsx(i,{})}),s.jsx(t.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],children:s.jsx(i,{placeholder:"请输入用户名"})}),s.jsx(t.Item,{name:"password",label:"密码",rules:[{required:!r.getFieldValue("id"),message:"请输入密码"}],children:s.jsx(i.Password,{placeholder:"请输入密码"})}),s.jsx(t.Item,{name:"nickname",label:"昵称",rules:[{required:!0,message:"请输入昵称"}],children:s.jsx(i,{placeholder:"请输入昵称"})}),s.jsx(t.Item,{name:"roleIds",label:"分配角色",rules:[{required:!0,message:"请至少选择一个角色"}],children:s.jsx(b,{mode:"multiple",placeholder:"请选择角色",showSearch:!0,optionFilterProp:"label",children:g.map(e=>s.jsx(k,{value:e.id,label:e.name,children:e.name},e.id))})}),s.jsx(t.Item,{name:"enabled",label:"是否启用",valuePropName:"checked",children:s.jsx(E,{})})]})})}),z=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));export{q as U,z as _,$ as a,U as b,M as u};
