import{r,ab as j,ax as v,ac as o,ay as T,ao as C,az as I,aA as S,ak as u,am as R}from"./index-D16-hzSU.js";import{T as w}from"./index-kCD4Ri1D.js";function b(a,s=0){return a.filter(t=>t.parentId===s&&t.type!=="button").map(t=>({...t,children:b(a,t.id)}))}function A(a){return a.filter(s=>s.type==="menu"&&s.visible!==!1).map(s=>{const t=a.filter(i=>i.type==="button"&&i.parentId===s.id);return{...s,buttons:t}})}const B=({visible:a,onClose:s,roleId:t})=>{const[i,y]=r.useState("menu"),[x,d]=r.useState([]),[h,f]=r.useState([]),m=r.useRef(null),l=j(e=>e.menu.init_menus),k=r.useMemo(()=>b(l,0),[l]),g=r.useMemo(()=>A(l),[l]),p=r.useCallback(async()=>{try{const e=await v(t);d(e.data.menuIds),f(e.data.buttonIds)}catch(e){console.error("加载权限失败:",e)}},[t]),M=async()=>{var e;try{const c=((e=m.current)==null?void 0:e.state.checkedKeys)||[],n=await S({roleId:t,menuIds:Array.from(c),buttonIds:Array.from(h)});n.code===200?(u.success(n.message),R(),s()):u.error(n.error)}catch(c){console.error("保存权限失败:",c),u.error("保存权限失败")}};r.useEffect(()=>{a&&t&&p()},[a,t,p]);const _=[{key:"menu",label:"菜单权限",children:o.jsx(w,{ref:m,checkable:!0,treeData:k,fieldNames:{title:"title",key:"id",children:"children"},checkedKeys:x,onCheck:e=>{d(e)},style:{maxHeight:600,overflowY:"auto",padding:10,border:"1px solid #f0f0f0",borderRadius:6}})},{key:"button",label:"按钮权限",children:o.jsx(o.Fragment,{children:g.map(e=>{var c;return o.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"8px 0"},children:[o.jsx("div",{style:{fontWeight:"bold",marginRight:"20px"},children:e.title}),o.jsx(T.Group,{value:h,onChange:n=>f(n),options:(c=e.buttons)==null?void 0:c.map(n=>({label:n.title,value:n.id}))})]},e.id)})})}];return o.jsx(C,{title:"分配权限",open:a,width:600,onCancel:s,onOk:M,maskClosable:!1,destroyOnHidden:!0,children:o.jsx(I,{items:_,activeKey:i,onChange:y})})},K=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as P,K as _};
