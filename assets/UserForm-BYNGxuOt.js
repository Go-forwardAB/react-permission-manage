import{bV as i,r as n,ab as v,at as t,au as F,ac as s,ao as _,ae as o,ak as f,am as w}from"./index-D16-hzSU.js";import{S as b}from"./index-BsGFmeDc.js";import{S as y}from"./index-D2xcTPMs.js";function L(a,d,u){return i.get(`/users?page=${a}&pageSize=${d}&username=${u}`)}function O(a){return i.post("/userSave",a)}function P(a){return i.post("/userDelete",a)}function M(a){return i.post("/userEnabled",a)}const{Option:V}=b,E=n.forwardRef(({onSuccess:a},d)=>{const u=v(e=>e.userInfo),[r]=t.useForm(),[c,m]=n.useState(!1),[h,x]=n.useState([]),[g,p]=n.useState(!1);n.useImperativeHandle(d,()=>({open:e=>{var l;r.resetFields(),e?r.setFieldsValue({...e,roleIds:((l=e.roleIds)==null?void 0:l.map(I=>I))||[]}):r.setFieldsValue({enabled:!0,roleIds:[]}),m(!0)}})),n.useEffect(()=>{c&&j()},[c]);const j=async()=>{const e=await F(1,9999,"");x(e.data)},S=async()=>{try{p(!0);const e=await r.validateFields(),l=await O(e);l.code===200?(f.success(l.message),m(!1),a(),e.id===u.id&&w()):f.error(l.message||"保存失败")}finally{p(!1)}};return s.jsx(_,{title:r.getFieldValue("id")?"编辑用户":"新增用户",open:c,onCancel:()=>m(!1),onOk:S,confirmLoading:g,width:500,destroyOnHidden:!0,children:s.jsxs(t,{form:r,labelCol:{span:5},children:[s.jsx(t.Item,{name:"id",hidden:!0,children:s.jsx(o,{})}),s.jsx(t.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],children:s.jsx(o,{placeholder:"请输入用户名"})}),s.jsx(t.Item,{name:"password",label:"密码",rules:[{required:!r.getFieldValue("id"),message:"请输入密码"}],children:s.jsx(o.Password,{placeholder:"请输入密码"})}),s.jsx(t.Item,{name:"nickname",label:"昵称",rules:[{required:!0,message:"请输入昵称"}],children:s.jsx(o,{placeholder:"请输入昵称"})}),s.jsx(t.Item,{name:"roleIds",label:"分配角色",rules:[{required:!0,message:"请至少选择一个角色"}],children:s.jsx(b,{mode:"multiple",placeholder:"请选择角色",showSearch:!0,optionFilterProp:"label",children:h.map(e=>s.jsx(V,{value:e.id,label:e.name,children:e.name},e.id))})}),s.jsx(t.Item,{name:"enabled",label:"是否启用",valuePropName:"checked",children:s.jsx(y,{})})]})})}),$=Object.freeze(Object.defineProperty({__proto__:null,default:E},Symbol.toStringTag,{value:"Module"}));export{E as U,$ as _,M as a,P as b,L as u};
