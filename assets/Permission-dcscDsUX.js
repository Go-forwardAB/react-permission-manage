import{r as a,ab as v,av as j,ac as o,aw as T,an as C,ax as S,ay as I,ak as u}from"./index-DoIqJqQh.js";import{T as w}from"./index-BxaE0QD7.js";function y(n,s=0){return n.filter(t=>t.parentId===s&&t.type!=="button").map(t=>({...t,children:y(n,t.id)}))}function R(n){return n.filter(s=>s.type==="menu"&&s.visible!==!1).map(s=>{const t=n.filter(i=>i.type==="button"&&i.parentId===s.id);return{...s,buttons:t}})}const B=({visible:n,onClose:s,roleId:t})=>{const[i,b]=a.useState("menu"),[k,d]=a.useState([]),[h,f]=a.useState([]),m=a.useRef(null),l=v(e=>e.menu.init_menus),x=a.useMemo(()=>y(l,0),[l]),g=a.useMemo(()=>R(l),[l]),p=a.useCallback(async()=>{try{const e=await j(t);d(e.data.menuIds),f(e.data.buttonIds)}catch(e){console.error("加载权限失败:",e)}},[t]),M=async()=>{var e;try{const c=((e=m.current)==null?void 0:e.state.checkedKeys)||[],r=await I({roleId:t,menuIds:Array.from(c),buttonIds:Array.from(h)});r.code===200?(u.success(r.message),s()):u.error(r.error)}catch(c){console.error("保存权限失败:",c),u.error("保存权限失败")}};a.useEffect(()=>{n&&t&&p()},[n,t,p]);const _=[{key:"menu",label:"菜单权限",children:o.jsx(w,{ref:m,checkable:!0,checkStrictly:!0,treeData:x,fieldNames:{title:"title",key:"id",children:"children"},checkedKeys:k,onCheck:e=>{d(e)},style:{maxHeight:600,overflowY:"auto",padding:10,border:"1px solid #f0f0f0",borderRadius:6}})},{key:"button",label:"按钮权限",children:o.jsx(o.Fragment,{children:g.map(e=>{var c;return o.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"8px 0"},children:[o.jsx("div",{style:{fontWeight:"bold",marginRight:"20px"},children:e.title}),o.jsx(T.Group,{value:h,onChange:r=>f(r),options:(c=e.buttons)==null?void 0:c.map(r=>({label:r.title,value:r.id}))})]},e.id)})})}];return o.jsx(C,{title:"分配权限",open:n,width:600,onCancel:s,onOk:M,maskClosable:!1,destroyOnHidden:!0,children:o.jsx(S,{items:_,activeKey:i,onChange:b})})},E=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as P,E as _};
